<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>24h du Mans - Prototype</title>
<style>
  body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
  #track {
    width: 2000px;
    height: 1335px;
    background-image: url('Circuit.jpg');
    background-size: cover;
    background-position: center;
    position: relative;
    margin-bottom: 20px;
  }

  .car { 
    width: 40px;    
    height: 24px;   
    position: absolute; 
    border-radius: 4px; 
    color: white; 
    text-align: center; 
    font-size: 16px; 
    line-height: 24px; 
  }

  .car-button {
    margin: 2px;
  }
</style>
</head>
<body>
<h1>24h du Mans - Prototype</h1>
<div id="track"></div>
<button id="addCar">Ajouter une voiture</button>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// ====== TA CONFIG FIREBASE ======
const firebaseConfig = {
  apiKey: "AIzaSyA0--XNG6-IxcEduQbGWhtqzBVdLJ0uNZE",
  authDomain: "le-124.firebaseapp.com",
  databaseURL: "https://le-124-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "le-124",
  storageBucket: "le-124.firebasestorage.app",
  messagingSenderId: "691928817966",
  appId: "1:691928817966:web:9c6cbddbc7332dabb11abf",
  measurementId: "G-0Q4ZDP0868"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// 48 cases simplifiées
const TRACK_POINTS = [
  {x:790, y:1016},{x:711, y:977},{x:578, y:909},{x:412, y:832},{x:248, y:717},{x:229, y:643},{x:263, y:581},{x:354, y:543},{x:416, y:499},{x:419, y:473},
  {x:386, y:462},{x:414, y:435},{x:459, y:413},{x:510, y:390},{x:571, y:356},{x:635, y:329},{x:711, y:324},{x:786, y:316},{x:782, y:358},{x:690, y:420},
  {x:707, y:460},{x:780, y:458},{x:879, y:424},{x:981, y:345},{x:1022, y:292},{x:1090, y:275},{x:1137, y:305},{x:1109, y:377},{x:1090, y:496},{x:1103, y:566},
  {x:1175, y:575},{x:1275, y:581},{x:1343, y:618},{x:1405, y:654},{x:1473, y:696},{x:1572, y:739},{x:1574, y:790},{x:1492, y:824},{x:1345, y:828},{x:1211, y:853},
  {x:1141, y:913},{x:1243, y:1015},{x:1339, y:1090},{x:1260, y:1138},{x:1147, y:1175},{x:981, y:1124},{x:886, y:1066},{x:777, y:1011}
];

let cars = {};
let carCount = 0;

// Dessine les voitures sur la piste
function drawCars(){
  const trackDiv = document.getElementById('track');
  trackDiv.innerHTML = '';
  for(const id in cars){
    const car = cars[id];
    const div = document.createElement('div');
    div.className='car';
    div.style.left = TRACK_POINTS[car.pos].x+'px';
    div.style.top = TRACK_POINTS[car.pos].y+'px';
    div.style.background = car.color;
    div.textContent = car.name[0];
    trackDiv.appendChild(div);
  }
}

// Crée les boutons Avancer / Reculer pour toutes les voitures
function createButtons(){
  // Supprime les anciens boutons
  document.querySelectorAll('.car-button').forEach(btn => btn.remove());

  for(const id in cars){
    const car = cars[id];

    // Bouton Avancer
    const btnForward = document.createElement('button');
    btnForward.textContent = "Avancer " + car.name;
    btnForward.className = 'car-button';
    btnForward.onclick = () => {
      firebase.database().ref('lemans/cars/'+id+'/pos').transaction(pos=>{
        return Math.min((pos||0)+1, TRACK_POINTS.length-1);
      });
    };
    document.body.appendChild(btnForward);

    // Bouton Reculer
    const btnBackward = document.createElement('button');
    btnBackward.textContent = "Reculer " + car.name;
    btnBackward.className = 'car-button';
    btnBackward.onclick = () => {
      firebase.database().ref('lemans/cars/'+id+'/pos').transaction(pos=>{
        return Math.max((pos||0)-1, 0);
      });
    };
    document.body.appendChild(btnBackward);
  }
}

// Ecoute la base Firebase
firebase.database().ref('lemans/cars').on('value', snap=>{
  cars = snap.val() || {};
  drawCars();
  createButtons(); // recrée les boutons à chaque changement
});

// Ajouter une voiture
document.getElementById('addCar').onclick = ()=>{
  const name = prompt("Nom de la voiture ?");
  if(!name) return;
  const id = 'car'+carCount++;
  const color = 'hsl(' + Math.floor(Math.random()*360) + ',70%,55%)';
  firebase.database().ref('lemans/cars/'+id).set({name,pos:0,color});
};
</script>
</body>
</html>
