<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>24h du Mans - Prototype</title>
<style>
  body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
  #track {
    width: 1536px;
    height: 1024px;
    background-image: url('Circuit 4.jpg');
    background-size: cover;
    background-position: center;
    position: relative;
    margin-bottom: 20px;
  }

  .car { 
    width: 40px;    
    height: 24px;   
    position: absolute; 
    border-radius: 4px; 
    color: white; 
    text-align: center; 
    font-size: 16px; 
    line-height: 24px; 
  }

  .car-button {
    margin: 2px;
  }
</style>
</head>
<body>
<h1>24h du Mans - Prototype</h1>
<div id="track"></div>
<button id="addCar">Ajouter une voiture</button>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// ====== TA CONFIG FIREBASE ======
const firebaseConfig = {
  apiKey: "AIzaSyA0--XNG6-IxcEduQbGWhtqzBVdLJ0uNZE",
  authDomain: "le-124.firebaseapp.com",
  databaseURL: "https://le-124-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "le-124",
  storageBucket: "le-124.firebasestorage.app",
  messagingSenderId: "691928817966",
  appId: "1:691928817966:web:9c6cbddbc7332dabb11abf",
  measurementId: "G-0Q4ZDP0868"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// 48 cases simplifiées
const TRACK_POINTS = [
 {x:180, y:780}, {x:210, y:760}, {x:250, y:740}, {x:300, y:720},
 {x:360, y:700}, {x:420, y:690}, {x:480, y:690}, {x:530, y:700},
 {x:580, y:720}, {x:630, y:750}, {x:670, y:780}, {x:710, y:810},
 {x:750, y:830}, {x:790, y:845}, {x:830, y:855}, {x:870, y:860},

 {x:920, y:850}, {x:960, y:830}, {x:1000, y:800}, {x:1030, y:760},
 {x:1055, y:720}, {x:1080, y:680}, {x:1105, y:635}, {x:1125, y:590},
 {x:1140, y:550}, {x:1150, y:500}, {x:1160, y:450}, {x:1165, y:405},
 {x:1165, y:360}, {x:1155, y:320}, {x:1140, y:280}, {x:1120, y:245},

 {x:1090, y:210}, {x:1055, y:185}, {x:1010, y:165}, {x:960, y:150},
 {x:905, y:140}, {x:850, y:135}, {x:790, y:135}, {x:725, y:145},
 {x:660, y:165}, {x:600, y:190}, {x:540, y:220}, {x:480, y:255},
 {x:420, y:300}, {x:350, y:350}, {x:280, y:415}, {x:210, y:500}
]
;

let cars = {};
let carCount = 0;

// Dessine les voitures sur la piste
function drawCars(){
  const trackDiv = document.getElementById('track');
  trackDiv.innerHTML = '';
  for(const id in cars){
    const car = cars[id];
    const div = document.createElement('div');
    div.className='car';
    div.style.left = TRACK_POINTS[car.pos].x+'px';
    div.style.top = TRACK_POINTS[car.pos].y+'px';
    div.style.background = car.color;
    div.textContent = car.name[0];
    trackDiv.appendChild(div);
  }
}

// Crée les boutons Avancer / Reculer pour toutes les voitures
function createButtons(){
  // Supprime les anciens boutons
  document.querySelectorAll('.car-button').forEach(btn => btn.remove());

  for(const id in cars){
    const car = cars[id];

    // Bouton Avancer
    const btnForward = document.createElement('button');
    btnForward.textContent = "Avancer " + car.name;
    btnForward.className = 'car-button';
    btnForward.onclick = () => {
      firebase.database().ref('lemans/cars/'+id+'/pos').transaction(pos=>{
        return Math.min((pos||0)+1, TRACK_POINTS.length-1);
      });
    };
    document.body.appendChild(btnForward);

    // Bouton Reculer
    const btnBackward = document.createElement('button');
    btnBackward.textContent = "Reculer " + car.name;
    btnBackward.className = 'car-button';
    btnBackward.onclick = () => {
      firebase.database().ref('lemans/cars/'+id+'/pos').transaction(pos=>{
        return Math.max((pos||0)-1, 0);
      });
    };
    document.body.appendChild(btnBackward);
  }
}

// Ecoute la base Firebase
firebase.database().ref('lemans/cars').on('value', snap=>{
  cars = snap.val() || {};
  drawCars();
  createButtons(); // recrée les boutons à chaque changement
});

// Ajouter une voiture
document.getElementById('addCar').onclick = ()=>{
  const name = prompt("Nom de la voiture ?");
  if(!name) return;
  const id = 'car'+carCount++;
  const color = 'hsl(' + Math.floor(Math.random()*360) + ',70%,55%)';
  firebase.database().ref('lemans/cars/'+id).set({name,pos:0,color});
};
</script>
</body>
</html>



